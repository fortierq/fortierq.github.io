---
title: "Développement Python en 2021 : les outils "
tags:
  - python
  - programmation
toc: true
toc_label: "Développement Python en 2021 : les outils"
toc_sticky: true
---

Alors que Python poursuit en 2020 sa [croissance exceptionnelle](https://www.tiobe.com/tiobe-index), la multiplication des outils à disposition du développeur Python peut être déconcertante. Essayons d'y voir plus clair.

Ce premier post liste les outils de gestion de projets Python qui me semblent les plus intéressants. Dans un deuxième volet, je parlerai des meilleures pratiques actuelles de la programmation en Python.

**Note** : Tout ce qui est écrit ici a été testé sous Ubuntu/Debian mais reste valable sous Windows, avec un peu plus d'efforts. Les versions récentes de Windows permettent en outre d'utiliser Linux via [WSL](https://docs.microsoft.com/fr-fr/windows/wsl/install-win10).  
{: .notice--info}

## Gérer les versions Python : pyenv

Commençons par le commencement: installer Python. Bien que Python soit installé nativement sur toute distribution Linux qui se respecte, changer de version à partir des sources peut être fastidieux. [pyenv](https://github.com/pyenv/pyenv) simplifie l'installation et l'utilisation de différentes versions de Python.  
Pour installer pyenv, le plus simple est de passer par ce [script](https://github.com/pyenv/pyenv-installer):

~~~ console
curl https://pyenv.run | bash
~~~

Ceci télécharge puis exécute [https://pyenv.run](https://pyenv.run), qui clone le dépôt [github.com:pyenv/pyenv](https://github.com/pyenv/pyenv) dans `~/.pyenv` et ajoute pyenv dans `~/.bashrc`.  
pyenv utilise un hook pour intercepter les commandes Python et choisir la bonne version à utiliser.  
Pour voir les versions de Python détectées:
~~~
pyenv global
~~~
**Note** : Sous Ubuntu, il n'y a pas de commande `python` par défaut, ce qui empêche pyenv de le détecter. Une solution est de créer un lien symbolique vers `python3`: `ln -s /usr/bin/python3 /usr/bin/python`.
{:  .notice--info}

Installons les éventuelles dépendances manquantes de Python: 
~~~
sudo apt-get update; sudo apt-get install --no-install-recommends make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
~~~

Ajoutons la version 3.9.1 de Python:
~~~
pyenv install 3.9.1
~~~
{:  .notice--info}
python3.9.1 est alors installé dans `~/.pyenv/versions/3.9.1`.

Il est possible de spécifier une version de Python au niveau global ou local:
~~~
pyenv global 3.9.1 # utiliser python3.9.1 globalement
pyenv local 3.9.1 # utiliser python3.9.1 localement (répertoire en cours)
~~~
{:  .notice--info}

`python`, `python3` ou `python3.9` permet alors d'utiliser notre version 3.9.1 fraîchement installée.

## EDI : PyCharm vs Visual Code 

![image-right](/assets/img/ide_python.png){: .align-right} 

PyCharm et Visual Code sont, de loin, les environnements de développement privilégiés par les développeurs Python.[^1]
Alors que PyCharm est spécifique au langage Python, Visual Code est un EDI "tout en un" qui est très utilisé aussi en développement web, par exemple. 
À noter que PyCharm est gratuit dans sa version *Community* mais payante et propriétaire en version *Professional*. Au contraire, Visual Code est entièrement gratuit et open source. J'ai personnellement adopté Visual Code pour sa légereté et ses nombreux plugins.

Voici quelques commandes Visual Code que j'ai trouvé particulièrement utiles:
- **Ctrl + Maj + P / F1**: ouvrir la liste des commandes  
  Certaines commandes n'ont pas de raccourci mais sont très pratiques: "Transform to Lower Case" ou "Sort Imports", par exemple  
- **Ctrl + P**: naviguer parmi les fichiers/fonctions
- **Ctrl + F5**: exécuter un fichier
- **F5**: débugger un fichier
- **Ctrl + C / Ctrl + V / Ctrl + X** (sans sélection): copier/coller/couper la ligne en cours
- **Alt + Up/Down**: déplacer une ligne vers le haut/bas
- **Alt + Clic**: selection multi-curseurs
- **Ctrl + Maj + L**: selectionner tous mots identiques

## Dépendances et packaging : Poetry vs Pipenv

Il est fortement déconseillé d'installer tous ses packages Python globalement: certains projets peuvent nécessiter des versions différentes du même package, il devient difficile de partager uniquement les dépendances nécessaires pour un projet...  
Un environnement virtuel permet de regrouper les packages requis pour un projet particulier. De nombreux développeurs utilisent [venv](https://docs.python.org/fr/3/tutorial/venv.html) pour créer des environnements virtuels et un fichier requirements.txt pour spécifier les packages à utiliser, avec leurs versions.  
[Poetry](https://python-poetry.org/) et [Pipenv](https://pipenv.pypa.io/en/latest/) sont des surcouches plus évolués de venv qui offrent plus de possibilités. Dans ce qui suit, je détaille l'utilisation de Poetry, les deux étant similaires.  .

Installer Poetry:
~~~
curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -
~~~

Créer un nouveau projet:
~~~
poetry new projet
~~~
Ceci génère la structure suivante:
~~~
projet/
├── projet
│   └── __init__.py
├── pyproject.toml
├── README.rst 
└── tests
    ├── __init__.py
    └── test_projet.py
~~~
Pour utiliser un projet existant:
~~~
poetry new projet
~~~
Le fichier [.toml](https://github.com/toml-lang/toml) généré ressemble à ceci:
~~~
[tool.poetry]
name = "projet"
version = "0.1.0"
description = ""
authors = ["Quentin Fortier <qpfortier@gmail.com>"]

[tool.poetry.dependencies]
python = "^3.9"

[tool.poetry.dev-dependencies]
pytest = "^5.2"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api" 
~~~

Ce fichier remplace `requirements.txt` en définissant les dépendances utilisées pour le projet. Ainsi, python = "^3.9" signifie que la version de Python doit être supérieure à 3.9, mais ne doit pas être mise à jour à la prochaine major release (4.*).

Ajoutons la dernière version de NumPy à notre projet:
~~~
poetry add numpy
~~~
Poetry ajoute alors `numpy` à `pyproject.toml` et génère un fichier `poetry.lock` avec toutes les dépendances et leurs versions exactes. Un autre utilisateur du projet pourra simplement exécuter `poetry install` pour les installer. L'option `--no-dev` permet de n'installer que ce qui est strictement nécessaire à l'exécution du code.

On peut ensuite utiliser notre environnement virtuel en écrivant `poetry run` ou `poetry shell`.  
Constatons par exemple que Poetry ajoute automatiquement notre projet au PYTHONPATH (plus besoin de manipuler `sys.path` à la main ni d'imports relatifs!):
~~~ console
poetry shell
(projet-v_ZTu9ix-py3.9) python -c "import sys; print(sys.path)"
~~~

Pour utiliser l'environnement virtuel de Poetry dans Visual Code, utiliser la commande "Python: Select Interpreter" puis donner le chemin correspondant (`~/.cache/pypoetry/virtualenvs/...`).

Enfin, après avoir rempli `pyproject.toml`, Poetry permet de construire le package et le publier sur [PyPI](https://pypi.org) simplement (oubliez setuptools!):
~~~
poetry --build publish
~~~

## Linting 
pyreverse

## AI complétion : tabnine

## Références

[^1]: [Python Developers Survey 2019](https://www.jetbrains.com/lp/python-developers-survey-2019), mené par la Python Software Foundation et Jetbrains, éditeur de PyCharm (...) et CLions, entre autres.
[^2]: https://cjolowicz.github.io/posts/hypermodern-python-01-setup/